<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יומן ניהול משימות - בנייה</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700;800&family=Noto+Sans+Ethiopic:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Login Screen -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-bg">
            <div class="concrete-texture"></div>
            <div class="rebar r1"></div><div class="rebar r2"></div><div class="rebar r3"></div><div class="rebar r4"></div>
            <div class="steel-beam sb1"></div><div class="steel-beam sb2"></div>
        </div>
        <div class="login-card">
            <!-- Language Selector on Login -->
            <div class="lang-selector login-lang">
                <button class="lang-btn active" data-lang="he" onclick="switchLanguage('he')">עברית</button>
                <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">English</button>
                <button class="lang-btn" data-lang="ru" onclick="switchLanguage('ru')">Русский</button>
                <button class="lang-btn" data-lang="am" onclick="switchLanguage('am')">አማርኛ</button>
            </div>
            <div class="login-logo">
                <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                    <rect width="60" height="60" rx="14" fill="url(#loginGrad)"/>
                    <defs><linearGradient id="loginGrad" x1="0" y1="0" x2="60" y2="60"><stop stop-color="#D97706"/><stop offset="1" stop-color="#92400E"/></linearGradient></defs>
                    <path d="M18 32h24v4a2 2 0 0 1-2 2H20a2 2 0 0 1-2-2v-4z" fill="white" opacity="0.9"/>
                    <path d="M20 32v-6a10 10 0 0 1 20 0v6" stroke="white" stroke-width="2.5" fill="none"/>
                    <line x1="16" y1="32" x2="44" y2="32" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                </svg>
            </div>
            <h1 class="login-title" data-i18n="login_title">יומן ניהול משימות</h1>
            <p class="login-subtitle" data-i18n="login_subtitle">מעקב אחר עבודות ופרויקטי בנייה</p>
            <form id="loginForm" class="login-form">
                <div class="login-input-group">
                    <label for="loginName" data-i18n="login_label">הכנס את שמך לכניסה למערכת</label>
                    <div class="login-input-wrapper">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        <input type="text" id="loginName" data-i18n-ph="login_placeholder" placeholder="השם המלא שלך..." required autocomplete="off">
                    </div>
                </div>
                <button type="submit" class="login-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    <span data-i18n="login_btn">כניסה למערכת</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Background -->
    <div class="bg-scene">
        <div class="concrete-bg"></div><div class="grid-floor"></div><div class="rebar-grid"></div>
        <div class="building b1"></div><div class="building b2"></div><div class="building b3"></div>
        <div class="building b4"></div><div class="building b5"></div><div class="building b6"></div>
        <div class="crane crane-1"><div class="crane-tower"></div><div class="crane-arm"></div><div class="crane-cable"></div></div>
        <div class="crane crane-2"><div class="crane-tower"></div><div class="crane-arm"></div><div class="crane-cable"></div></div>
        <div class="particle p1"></div><div class="particle p2"></div><div class="particle p3"></div>
        <div class="particle p4"></div><div class="particle p5"></div><div class="particle p6"></div>
        <div class="bg-beam beam1"></div><div class="bg-beam beam2"></div><div class="bg-beam beam3"></div>
    </div>

    <div class="app-container" id="appContainer" style="display:none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <svg width="44" height="44" viewBox="0 0 44 44" fill="none"><rect width="44" height="44" rx="12" fill="url(#logoGrad2)"/><defs><linearGradient id="logoGrad2" x1="0" y1="0" x2="44" y2="44"><stop stop-color="#D97706"/><stop offset="1" stop-color="#92400E"/></linearGradient></defs><path d="M13 22L19 28L31 14" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <div>
                        <h1 data-i18n="app_title">יומן ניהול משימות</h1>
                        <p class="subtitle" data-i18n="app_subtitle">מעקב אחר עבודות ופרויקטי בנייה</p>
                    </div>
                </div>
                <div class="header-right">
                    <!-- Language Selector in Header -->
                    <div class="lang-selector header-lang">
                        <button class="lang-btn active" data-lang="he" onclick="switchLanguage('he')">עב</button>
                        <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">EN</button>
                        <button class="lang-btn" data-lang="ru" onclick="switchLanguage('ru')">РУ</button>
                        <button class="lang-btn" data-lang="am" onclick="switchLanguage('am')">አማ</button>
                    </div>
                    <div class="user-badge" id="userBadge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        <span id="loggedUserName"></span>
                        <button class="logout-btn" onclick="logout()" data-i18n-title="logout_title" title="התנתק">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        </button>
                    </div>
                    <div class="header-stats">
                        <div class="stat-card"><span class="stat-number" id="totalTasks">0</span><span class="stat-label" data-i18n="stat_total">סה"כ</span></div>
                        <div class="stat-card stat-working"><span class="stat-number" id="workingTasks">0</span><span class="stat-label" data-i18n="stat_working">בעבודה</span></div>
                        <div class="stat-card stat-waiting"><span class="stat-number" id="waitingTasks">0</span><span class="stat-label" data-i18n="stat_waiting">בהמתנה</span></div>
                        <div class="stat-card stat-done"><span class="stat-number" id="completedTasks">0</span><span class="stat-label" data-i18n="stat_completed">הושלמו</span></div>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Form -->
            <section class="form-section">
                <div class="section-header"><h2><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg><span data-i18n="form_title">הוספת משימה חדשה</span></h2></div>
                <form id="taskForm" class="task-form">
                    <div class="form-grid form-grid-3">
                        <div class="form-group">
                            <label for="workerName"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span data-i18n="lbl_worker">שם העובד</span></label>
                            <input type="text" id="workerName" data-i18n-ph="ph_worker" placeholder="הכנס את שם העובד" required>
                        </div>
                        <div class="form-group">
                            <label for="projectNumber"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg><span data-i18n="lbl_project">מספר פרויקט</span></label>
                            <input type="text" id="projectNumber" data-i18n-ph="ph_project" placeholder="הכנס מספר פרויקט" required>
                        </div>
                        <div class="form-group">
                            <label for="workType"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg><span data-i18n="lbl_worktype">סוג עבודה</span></label>
                            <select id="workType" required>
                                <option value="" disabled selected data-i18n-opt="ph_worktype">בחר סוג עבודה</option>
                                <option value="DT">DT</option>
                                <option value="GEO">GEO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="priority"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg><span data-i18n="lbl_priority">דחיפות פרויקט</span></label>
                            <select id="priority" required>
                                <option value="" disabled selected data-i18n-opt="ph_priority">בחר רמת דחיפות</option>
                                <option value="critical" data-i18n-opt="opt_critical">קריטי - דרוש טיפול מיידי</option>
                                <option value="high" data-i18n-opt="opt_high">גבוה - דחוף</option>
                                <option value="medium" data-i18n-opt="opt_medium">בינוני - רגיל</option>
                                <option value="low" data-i18n-opt="opt_low">נמוך - לא דחוף</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span data-i18n="lbl_status">סטטוס משימה</span></label>
                            <select id="status" required>
                                <option value="working" selected data-i18n-opt="opt_working">בעבודה</option>
                                <option value="waiting" data-i18n-opt="opt_waiting">בהמתנה</option>
                                <option value="completed" data-i18n-opt="opt_completed">הושלם</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="startDate"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span data-i18n="lbl_start_date">תאריך קבלת העבודה</span></label>
                            <input type="date" id="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><path d="M9 16l2 2 4-4"/></svg><span data-i18n="lbl_end_date">תאריך סיום העבודה</span></label>
                            <input type="date" id="endDate">
                            <small class="field-hint" data-i18n="hint_enddate">השאר ריק אם העבודה לא הסתיימה</small>
                        </div>
                        <div class="form-group full-width">
                            <label for="workDescription"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="17" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="17" y1="18" x2="3" y2="18"/></svg><span data-i18n="lbl_description">תיאור העבודה</span></label>
                            <textarea id="workDescription" rows="3" data-i18n-ph="ph_description" placeholder="תאר את העבודה שבוצעה..." required></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            <span data-i18n="btn_add">הוסף משימה</span>
                        </button>
                        <button type="button" class="btn btn-secondary" id="cancelEditBtn" style="display:none;" onclick="cancelEdit()">
                            <span data-i18n="btn_cancel_edit">ביטול עריכה</span>
                        </button>
                    </div>
                </form>
            </section>

            <!-- Filter -->
            <section class="filter-section">
                <div class="search-box">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" id="searchInput" data-i18n-ph="ph_search" placeholder="חיפוש לפי שם, פרויקט או תיאור...">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all" data-i18n="filter_all">הכל</button>
                    <button class="filter-btn" data-filter="working" data-i18n="filter_working">בעבודה</button>
                    <button class="filter-btn" data-filter="waiting" data-i18n="filter_waiting">בהמתנה</button>
                    <button class="filter-btn" data-filter="completed" data-i18n="filter_completed">הושלמו</button>
                </div>
                <button class="btn btn-export" onclick="exportToCSV()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    <span data-i18n="btn_export">ייצוא לאקסל</span>
                </button>
            </section>

            <!-- Table -->
            <section class="table-section">
                <div class="table-wrapper">
                    <table id="tasksTable">
                        <thead><tr>
                            <th data-i18n="th_num">#</th>
                            <th data-i18n="th_worker">שם העובד</th>
                            <th data-i18n="th_project">מספר פרויקט</th>
                            <th data-i18n="th_worktype">סוג עבודה</th>
                            <th data-i18n="th_description">תיאור העבודה</th>
                            <th id="thPriority" class="sortable-th" onclick="togglePrioritySort()" data-i18n-title="tip_sort_priority" title="מיין לפי דחיפות"><span data-i18n="th_priority">דחיפות</span><span class="sort-arrow"></span></th>
                            <th data-i18n="th_start">תאריך קבלה</th>
                            <th data-i18n="th_end">תאריך סיום</th>
                            <th data-i18n="th_status">סטטוס</th>
                            <th data-i18n="th_updated">עודכן אחרון</th>
                            <th data-i18n="th_actions">פעולות</th>
                        </tr></thead>
                        <tbody id="tasksBody"></tbody>
                    </table>
                </div>
                <div class="empty-state" id="emptyState">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#CBD5E1" stroke-width="1"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                    <h3 data-i18n="empty_title">אין משימות עדיין</h3>
                    <p data-i18n="empty_text">הוסף את המשימה הראשונה שלך באמצעות הטופס למעלה</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg></div>
            <h3 data-i18n="modal_delete_title">מחיקת משימה</h3>
            <p><span data-i18n="modal_delete_text">האם אתה בטוח שברצונך למחוק את המשימה?</span><br><span data-i18n="modal_delete_text2">פעולה זו אינה ניתנת לביטול.</span></p>
            <div class="modal-actions">
                <button class="btn btn-danger" id="confirmDeleteBtn" data-i18n="btn_delete">מחק</button>
                <button class="btn btn-secondary" onclick="closeDeleteModal()" data-i18n="btn_cancel">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

    <script src="lang.js"></script>
    <script src="script.js"></script>
</body>
</html>
